
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kayrileyde Santos | Studio Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600&family=Playfair+Display:ital,wght@1,500;1,600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --nude: #FAF9F6; --gold: #C5A059; --charcoal: #1A1A1A; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--nude); color: var(--charcoal); }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }
        .btn-gold { background: var(--gold); color: white; transition: 0.3s; }
        .btn-gold:hover { background: #AD8B4A; transform: translateY(-2px); }
        .glass { background: white; border: 1px solid rgba(197, 160, 89, 0.2); box-shadow: 0 15px 35px rgba(0,0,0,0.02); }
        .card-service { border: 1px solid #f0f0f0; transition: 0.2s; cursor: pointer; border-radius: 1rem; background: white; }
        .card-service.active { border-color: var(--gold); background: #fdfaf5; }
        .view-section { display: none; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .status-badge { font-size: 9px; padding: 2px 8px; border-radius: 20px; font-weight: bold; text-transform: uppercase; }
        input, select { border: 1px solid #ddd !important; border-radius: 0.8rem !important; padding: 0.8rem !important; outline: none; background: white !important; }
    </style>
</head>
<body class="antialiased">

    <!-- BARRA DE TOPO -->
    <nav class="p-6 flex justify-between items-center max-w-6xl mx-auto sticky top-0 z-50 backdrop-blur-md">
        <h1 class="italic text-2xl text-stone-900 leading-none">Kayrileyde Santos</h1>
        <button onclick="toggleAdmin()" class="w-10 h-10 rounded-full flex items-center justify-center border border-stone-200 hover:bg-white transition-all shadow-sm">
            <i data-lucide="shield-check" class="text-stone-400 w-4 h-4"></i>
        </button>
    </nav>

    <!-- [P√ÅGINA DA CLIENTE] -->
    <main id="view-cliente" class="view-section max-w-2xl mx-auto p-6 pb-24" style="display: block;">
        <header class="text-center py-12">
            <h2 class="text-4xl font-light mb-4 italic leading-tight">Escolha sua transforma√ß√£o.</h2>
            <p class="text-stone-400 text-[10px] uppercase tracking-[0.5em] font-bold">Studio de Luxo</p>
        </header>

        <div id="services-grid" class="space-y-3">
            <p class="text-center py-20 animate-pulse text-stone-300">Acessando menu...</p>
        </div>

        <div id="total-bar" class="hidden mt-8 p-8 glass rounded-[2rem] flex justify-between items-center border-gold/30">
            <div>
                <span class="text-[10px] font-bold uppercase text-stone-400 block">Total Estimado</span>
                <span id="display-total" class="text-2xl font-bold text-stone-900 italic">R$ 0,00</span>
            </div>
            <button onclick="document.getElementById('form-booking').classList.remove('hidden'); document.getElementById('form-booking').scrollIntoView({behavior:'smooth'})" class="btn-gold px-8 py-3 rounded-xl font-bold uppercase text-[10px] tracking-widest shadow-lg">Agendar</button>
        </div>

        <section id="form-booking" class="hidden mt-10 glass p-8 rounded-[2rem] space-y-4">
            <input type="text" id="c-name" placeholder="Seu nome" class="w-full">
            <input type="tel" id="c-phone" placeholder="Seu WhatsApp" class="w-full">
            <div class="grid grid-cols-2 gap-4">
                <input type="date" id="c-date" class="w-full">
                <input type="time" id="c-time" class="w-full">
            </div>
            <button onclick="saveBooking()" class="w-full btn-gold py-5 rounded-2xl font-bold uppercase tracking-widest shadow-xl">Confirmar no WhatsApp</button>
        </section>
    </main>

    <!-- [PAINEL ADMINISTRATIVO] -->
    <main id="view-admin" class="view-section max-w-6xl mx-auto p-6 pb-24">
        <div class="flex justify-between items-center mb-10">
            <h2 class="text-2xl font-bold italic underline decoration-gold">Gest√£o do Studio</h2>
            <button onclick="toggleAdmin()" class="text-xs font-bold text-stone-400 uppercase border px-4 py-2 rounded-lg">Sair</button>
        </div>

        <!-- STATS -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">
            <div class="glass p-8 rounded-[2rem]">
                <p class="text-stone-400 text-[10px] font-bold uppercase mb-1">Lucro (Atendidos/Confirmados)</p>
                <h3 id="stat-profit" class="text-4xl font-bold text-stone-900 tracking-tighter italic">R$ 0,00</h3>
            </div>

            <!-- GERENCIAR SERVI√áOS -->
            <div class="glass p-8 rounded-[2rem] lg:col-span-2">
                <p class="text-stone-400 text-[10px] font-bold uppercase mb-4 italic">Ajustar Pre√ßos e Servi√ßos</p>
                <div id="admin-services-list" class="space-y-2 max-h-40 overflow-y-auto pr-2 mb-4"></div>
                <div class="flex gap-2">
                    <input type="text" id="new-s-name" placeholder="Novo Servi√ßo" class="flex-1 !p-2 text-xs">
                    <input type="text" id="new-s-price" placeholder="Pre√ßo" class="w-20 !p-2 text-xs">
                    <button onclick="addService()" class="btn-gold px-4 rounded-xl text-xs">+</button>
                </div>
            </div>
        </div>

        <!-- AGENDA -->
        <div class="glass p-8 rounded-[2.5rem]">
            <h3 class="font-bold text-xl mb-8 italic">Agenda de Clientes</h3>
            <div id="admin-bookings-list" class="space-y-6"></div>
        </div>
    </main>

    <script type="module">
        const _URL = "https://rbhgxrcqqtxnzzyllqms.supabase.co";
        const _KEY = "sb_publishable_OH1hqvBo8vmj_qsvtjKZhQ_QKTg4mLg";
        const supabase = window.supabase.createClient(_URL, _KEY);

        let selected = [];
        let studioCfg = {};

        async function init() {
            lucide.createIcons();
            const { data } = await supabase.from('configs').select('*').single();
            studioCfg = data;
            loadServices();
        }

        async function loadServices() {
            const { data: servs } = await supabase.from('servicos').select('*').order('nome');
            const grid = document.getElementById('services-grid');
            const adminServList = document.getElementById('admin-services-list');
            grid.innerHTML = '';
            adminServList.innerHTML = '';

            servs.forEach(s => {
                // Para a cliente
                const el = document.createElement('div');
                el.className = "card-service p-5 flex justify-between items-center shadow-sm";
                el.innerHTML = `<span class="font-bold text-stone-700">${s.nome}</span><span class="font-bold text-stone-400 italic">R$ ${s.preco}</span>`;
                el.onclick = () => {
                    const idx = selected.findIndex(item => item.id === s.id);
                    if(idx > -1) { selected.splice(idx, 1); el.classList.remove('active'); }
                    else { selected.push(s); el.classList.add('active'); }
                    const tot = selected.reduce((acc, c) => acc + parseFloat(c.preco), 0);
                    document.getElementById('display-total').innerText = `R$ ${tot.toFixed(2)}`;
                    document.getElementById('total-bar').classList.toggle('hidden', selected.length === 0);
                };
                grid.appendChild(el);

                // Para o ADM (Edi√ß√£o)
                adminServList.innerHTML += `
                    <div class="flex justify-between items-center bg-stone-50 p-2 rounded-lg text-xs">
                        <span>${s.nome}</span>
                        <div class="flex gap-2 items-center">
                            <input type="text" value="${s.preco}" onchange="updateServicePrice('${s.id}', this.value)" class="w-16 !p-1 text-center border-none font-bold">
                            <button onclick="deleteService('${s.id}')" class="text-red-400 hover:text-red-600"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                        </div>
                    </div>`;
            });
            lucide.createIcons();
        }

        window.saveBooking = async () => {
            const name = document.getElementById('c-name').value;
            const phone = document.getElementById('c-phone').value;
            const date = document.getElementById('c-date').value;
            const time = document.getElementById('c-time').value;
            if(!name || !phone || !date || !time) return alert("Preencha todos os campos!");

            const tot = selected.reduce((acc, c) => acc + parseFloat(c.preco), 0);
            const names = selected.map(s => s.nome).join(', ');

            const { error } = await supabase.from('agendamentos').insert([{
                cliente_nome: name, cliente_whatsapp: phone, servicos_escolhidos: names,
                data: date, horario: time, valor_total: tot
            }]);

            if(!error) {
                const msg = `Ol√° Kayrileyde! Sou ${name}. Agendei: ${names} para o dia ${date.split('-').reverse().join('/')} √†s ${time}.`;
                window.open(`https://wa.me/${studioCfg.whatsapp}?text=${encodeURIComponent(msg)}`);
                location.reload();
            }
        };

        window.toggleAdmin = async () => {
            const adm = document.getElementById('view-admin');
            const cli = document.getElementById('view-cliente');
            if(adm.style.display === 'block') { adm.style.display = 'none'; cli.style.display = 'block'; }
            else { 
                if(prompt("Senha:") === studioCfg.senha_adm) {
                    cli.style.display = 'none'; adm.style.display = 'block'; loadDash();
                }
            }
        };

        async function loadDash() {
            const { data: agends } = await supabase.from('agendamentos').select('*').order('data', {ascending: false});
            const list = document.getElementById('admin-bookings-list');
            list.innerHTML = '';
            let profit = 0;

            agends.forEach(a => {
                if(a.status === 'Atendido' || a.status === 'Confirmado') profit += parseFloat(a.valor_total);
                
                list.innerHTML += `
                    <div class="p-6 bg-white border border-stone-100 rounded-[1.5rem] shadow-sm">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <span class="status-badge ${getStatusClass(a.status)}">${a.status}</span>
                                <h4 class="font-bold text-lg mt-1">${a.cliente_nome}</h4>
                                <p class="text-xs text-stone-400 italic">${a.servicos_escolhidos}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-stone-900 italic">R$ ${a.valor_total}</p>
                                <p class="text-[10px] font-bold text-stone-400 uppercase tracking-widest">${a.data} ‚Ä¢ ${a.horario}</p>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2 pt-4 border-t border-stone-50">
                            <button onclick="updateStatus('${a.id}', 'Confirmado')" class="text-[8px] bg-blue-50 text-blue-600 px-3 py-2 rounded-lg font-bold uppercase">Confirmar</button>
                            <button onclick="updateStatus('${a.id}', 'Atendido')" class="text-[8px] bg-green-50 text-green-600 px-3 py-2 rounded-lg font-bold uppercase">Atendida</button>
                            <button onclick="updateStatus('${a.id}', 'Desmarcado')" class="text-[8px] bg-red-50 text-red-600 px-3 py-2 rounded-lg font-bold uppercase">Desmarcou</button>
                            <button onclick="sendReminder('${a.cliente_whatsapp}', '${a.cliente_nome}', '${a.horario}')" class="text-[8px] bg-stone-900 text-white px-3 py-2 rounded-lg font-bold uppercase ml-auto">Lembrar Zap</button>
                        </div>
                    </div>`;
            });
            document.getElementById('stat-profit').innerText = `R$ ${profit.toFixed(2)}`;
            lucide.createIcons();
        }

        function getStatusClass(s) {
            if(s === 'Atendido') return 'bg-green-100 text-green-700';
            if(s === 'Confirmado') return 'bg-blue-100 text-blue-700';
            if(s === 'Desmarcado') return 'bg-red-100 text-red-700';
            return 'bg-amber-100 text-amber-700';
        }

        window.updateStatus = async (id, status) => {
            await supabase.from('agendamentos').update({ status }).eq('id', id);
            loadDash();
        };

        window.updateServicePrice = async (id, price) => {
            await supabase.from('servicos').update({ preco: parseFloat(price.replace(',','.')) }).eq('id', id);
            alert("Pre√ßo Atualizado!");
        };

        window.addService = async () => {
            const n = document.getElementById('new-s-name').value;
            const p = document.getElementById('new-s-price').value.replace(',','.');
            await supabase.from('servicos').insert([{ nome: n, preco: parseFloat(p) }]);
            location.reload();
        };

        window.deleteService = async (id) => {
            if(confirm("Excluir servi√ßo?")) {
                await supabase.from('servicos').delete().eq('id', id);
                location.reload();
            }
        };

        window.sendReminder = (p, n, h) => {
            const msg = `Ol√° ${n}! ‚ú® Aqui √© do Studio Kayrileyde Santos. Passando para confirmar seu hor√°rio hoje √†s ${h}. Podemos confirmar? ü•Ç`;
            window.open(`https://wa.me/${p.replace(/\D/g, '')}?text=${encodeURIComponent(msg)}`);
        };

        init();
    </script>
</body>
</html>
